<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—¬í–‰ ì •ë³´</title>
    <link rel="stylesheet" href="common.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f8ff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
            max-width: 800px;
            width: 100%;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        p {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }
        .weather-day {
            display: inline-block;
            margin: 10px;
            padding: 15px;
            background-color: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 8px;
            text-align: left;
            vertical-align: top;
        }
        .weather-day .temp {
            font-weight: bold;
            color: #e64a19;
        }
        .weather-day .rain {
            color: #1976d2;
        }
        .item-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        .packed-item {
            background-color: #d9eaff;
            border: 2px solid #4a90e2;
            border-radius: 8px;
            padding: 10px 15px;
            font-weight: bold;
            font-size: 16px;
            color: #333;
            text-align: center;
        }
        .back-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 30px;
            transition: background-color 0.3s;
        }
        .back-button:hover {
            background-color: #0056b3;
        }
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .popup-content {
            background-color: white;
            padding: 30px 40px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .popup-content p {
            margin: 0 0 20px;
            font-size: 20px;
        }
        .popup-content button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .popup-content button:hover {
            background-color: #0056b3;
        }
        .stress-text-transition {
            transition: color 0.5s ease-in-out; /* Smooth color transition */
        }
    </style>
<body>
    <audio id="click-sound" src="audio/click.mp3" preload="auto"></audio>
    <audio id="ocean-waves-sound" src="audio/ocean-waves.mp3" loop></audio>
    <audio id="gameover-sound" src="audio/gameover.mp3"></audio>
    <audio id="success-sound" src="audio/success.mp3"></audio>
    <audio id="fail-sound" src="audio/fail.mp3"></audio>

    <div id="start-popup" class="popup-overlay">
        <div class="popup-content">
            <p>6ê°œì›” ì „ë¶€í„° ê³„íší•œ ì†Œì¤‘í•œ ì—¬í–‰. ì´ì œ ì‹œì‘í•©ë‹ˆë‹¤.</p>
            <button id="start-button">í™•ì¸</button>
        </div>
    </div>
    <div class="container">
        <h1>ë‚˜ì˜ ì—¬í–‰ ì •ë³´</h1>

        <h2>ì—¬í–‰ ê°œìš”</h2>
        <p id="travel-country"></p>
        <p id="travel-days"></p>
        <p id="travel-accommodation"></p>

        <div id="outcome-display" style="margin-top: 20px; text-align: center;">
            <div id="background-image" style="width: 100%; height: 300px; background-size: cover; background-position: center; position: relative;">
                <div id="rain-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.3); background-image: url('img/rain_effect.png'); background-size: cover; display: none;"></div>
                <div id="current-time-display" style="position: absolute; top: 10px; right: 10px; color: white; font-size: 16px; font-weight: bold; background-color: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px;">
                    <!-- Current time will be displayed here -->
                </div>
                <button id="speed-toggle-btn" style="position: absolute; top: 45px; right: 10px; padding: 5px 10px; border-radius: 5px; border: none; background-color: rgba(0,0,0,0.5); color: white; cursor: pointer;">2ë°°ì†ìœ¼ë¡œ</button>
                <div id="stress-bar-container" style="position: absolute; top: 10px; left: 10px; width: 200px; height: 20px; background-color: rgba(0,0,0,0.5); border-radius: 5px; overflow: hidden;">
                    <div id="stress-bar" style="height: 100%; width: 100%; background-color: yellow; transition: width 2s ease-in-out;"></div>
                    <div id="stress-text" class="stress-text-transition" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; color: blue; text-align: center; line-height: 20px; font-size: 14px; font-weight: bold;"></div>
                </div>
                <div id="stress-item-display" style="position: absolute; top: 40px; left: 10px; color: white; font-size: 14px; background-color: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px; text-align: left; max-height: 150px; overflow-y: auto;">
                    <!-- Item effects will be displayed here -->
                </div>
                <div id="stress-log-display" style="position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 770px; max-height: 60px; overflow-y: auto; background-color: rgba(0,0,0,0.7); color: white; padding: 7px; border-radius: 5px; text-align: center; font-size: 15px;">
                    <!-- Stress log messages will appear here -->
                </div>
            </div>
            <p id="outcome-message" style="font-size: 24px; font-weight: bold; margin-top: 15px; color: #333;"></p>
        </div>

        

        <h2>ë‚ ì”¨ ì •ë³´</h2>
        <div id="weather-details"></div>

        <h2>ì±™ê¸´ ì§ ëª©ë¡</h2>
        <div id="packed-items-list" class="item-list"></div>

        <button class="back-button" onclick="window.location.href='pack.html'">ë‹¤ì‹œ ì§ì‹¸ëŸ¬ ê°€ê¸°</button>
    </div>

    <div id="score-modal" class="popup-overlay" style="display: none;">
        <div class="popup-content" style="width: 600px; text-align: left;">
            <div id="score-modal-content">
                <!-- Score details will be injected here by JS -->
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <input type="text" id="player-name" placeholder="ì ìˆ˜ë¥¼ ë“±ë¡í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" style="padding: 10px; width: 60%; border-radius: 5px; border: 1px solid #ccc;">
                <button id="save-score-btn" class="btn" style="margin-left: 10px;">ì ìˆ˜ ë“±ë¡</button>
            </div>
            <button id="close-score-modal-btn" class="btn" style="margin-top: 10px; background-color: #777; display: block; margin-left: auto; margin-right: auto;">ë‹«ê¸°</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const supabaseUrl = 'https://npbesdliuxfmyuuqvach.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5wYmVzZGxpdXhmbXl1dXF2YWNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzNjcwOTcsImV4cCI6MjA3MTk0MzA5N30.xntp2q4J0z85JoNQ-uLqRyOz9_dkxosBaxgC5JGmqds';
            const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

            const savedData = localStorage.getItem('travelGameData');
            const oceanWavesSound = document.getElementById('ocean-waves-sound');
            const gameoverSound = document.getElementById('gameover-sound');
            const successSound = document.getElementById('success-sound');
            const failSound = document.getElementById('fail-sound');
            let bonusEvents = 0;
            let finalCalculatedScore = 0; // New variable to hold the final score

            if (savedData) {
                const data = JSON.parse(savedData);

                // Modal Elements
                const scoreModal = document.getElementById('score-modal');
                const scoreModalContent = document.getElementById('score-modal-content');
                const saveScoreBtn = document.getElementById('save-score-btn');
                const closeScoreModalBtn = document.getElementById('close-score-modal-btn');
                const playerNameInput = document.getElementById('player-name');

                // Modal Event Listeners
                closeScoreModalBtn.addEventListener('click', () => { scoreModal.style.display = 'none'; });
                saveScoreBtn.addEventListener('click', async () => {
                    const playerName = playerNameInput.value.trim();
                    if (!playerName) {
                        alert('ì ìˆ˜ë¥¼ ë“±ë¡í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                        return;
                    }

                    const countryName = data.travelInfo.country;

                    // Save the score
                    const { data: insertResult, error: insertError } = await supabase
                        .from('score')
                        .insert([{ name: playerName, score: finalCalculatedScore, country: countryName }])
                        .select(); // Use .select() to get the inserted row back

                    if (insertError) {
                        console.error('Error saving score:', insertError);
                        alert('ì ìˆ˜ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + insertError.message);
                        return;
                    }

                    alert(`${playerName}ë‹˜ì˜ ì ìˆ˜ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                    const savedRecord = insertResult[0];

                    // Fetch all scores for the country
                    const { data: scores, error: fetchError } = await supabase
                        .from('score')
                        .select('id, name, score, created_at')
                        .eq('country', countryName)
                        .order('score', { ascending: false });

                    if (fetchError) {
                        console.error('Error fetching scores:', fetchError);
                        alert('ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + fetchError.message);
                        scoreModal.style.display = 'none';
                        return;
                    }

                    // Generate and display the ranking
                    let rankingHtml = `<h2 style="text-align: center;">${countryName} ë­í‚¹</h2><ul style="padding-left: 0; list-style-type: none; max-height: 300px; overflow-y: auto;">`;
                    let userRank = -1;

                    scores.forEach((score, index) => {
                        const isCurrentUser = score.id === savedRecord.id;
                        if (isCurrentUser) {
                            userRank = index + 1;
                        }
                        rankingHtml += `<li style="padding: 5px; border-radius: 3px; ${isCurrentUser ? 'background-color: yellow;' : ''}">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>${index + 1}ìœ„: ${score.name}</span>
                                <span>${score.score}ì </span>
                            </div>
                            <small style="display: block; color: #666; text-align: left;">${new Date(score.created_at).toLocaleString()}</small>
                        </li>`;
                    });
                    rankingHtml += '</ul>';

                    if (userRank !== -1) {
                        scoreModalContent.innerHTML = rankingHtml;
                        document.getElementById('player-name').style.display = 'none';
                        saveScoreBtn.style.display = 'none';
                        closeScoreModalBtn.textContent = 'ë­í‚¹ ë‹«ê¸°';
                    } else {
                        alert('ë­í‚¹ì—ì„œ í˜„ì¬ ê¸°ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        scoreModal.style.display = 'none';
                    }
                });


                // Display Travel Overview
                document.getElementById('travel-country').textContent = `ì—¬í–‰ì§€: ${data.travelInfo.country}`;
                document.getElementById('travel-days').textContent = `ì—¬í–‰ ê¸°ê°„: ${data.travelInfo.numberOfDays}ì¼`;
                document.getElementById('travel-accommodation').textContent = `ìˆ™ë°•: ${data.travelInfo.accommodationType}`;

                // Display Weather Details
                const weatherDetailsEl = document.getElementById('weather-details');
                data.travelInfo.weather.forEach(dayData => {
                    const dayEl = document.createElement('div');
                    dayEl.classList.add('weather-day');
                    dayEl.innerHTML = '<p>' + dayData.day + '</p>' +
                                      '<p class="temp">' + dayData.minTemp + 'Â°C ~ ' + dayData.maxTemp + 'Â°C</p>' +
                                      '<p class="rain">ê°•ìˆ˜í™•ë¥ : ' + dayData.rainChance + '%</p>';
                    weatherDetailsEl.appendChild(dayEl);
                });

                // Display Packed Items
                const packedItemsListEl = document.getElementById('packed-items-list');
                if (data.packedItems.length > 0) {
                    data.packedItems.forEach(item => {
                        const itemEl = document.createElement('div');
                        itemEl.classList.add('packed-item');
                        itemEl.textContent = `${item.name} (${item.weight}kg)`;
                        packedItemsListEl.appendChild(itemEl);
                    });
                } else {
                    packedItemsListEl.innerHTML = '<p>ì±™ê¸´ ì§ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }

                // Stress Mechanic
                let currentStress = 60;
                const stressBarEl = document.getElementById('stress-bar');
                const stressTextEl = document.getElementById('stress-text');
                stressBarEl.style.width = currentStress + '%'; // Set initial stress bar width
                stressTextEl.textContent = currentStress; // Set initial stress text

                const currentTimeDisplayEl = document.getElementById('current-time-display');
				const stressLogDisplayEl = document.getElementById('stress-log-display');

                const allItemsData = data.allItemsData; // Get all items data
                const packedItemIds = new Set(data.packedItems.map(item => item.id)); // Get IDs of packed items

                function countItem(itemName) {
                    return data.packedItems.filter(item => item.name === itemName).length;
                }

                // Identify essential items that were NOT packed
                const missingEssentialItems = allItemsData.filter(item => item.isEssential && !packedItemIds.has(item.id));
                const hasMissingEssentials = missingEssentialItems.length > 0;

                let currentDay = 1;
                let currentTimeIndex = 0;
                let intervalDuration = 5000; // 5 seconds, changed to let

                const timeSlots = {
                    firstDay: ['ê³µí•­', 'ë§ˆíŠ¸', 'ì˜¤í›„ ê´€ê´‘', 'ì €ë…'],
                    intermediateDay: ['ìƒˆë²½', 'ì•„ì¹¨', 'ì˜¤ì „ ê´€ê´‘', 'ì ì‹¬', 'ì˜¤í›„ ê´€ê´‘', 'ì €ë…'],
                    lastDay: ['ìƒˆë²½', 'ì•„ì¹¨', 'ì˜¤ì „ ê´€ê´‘']
                };

                // Speed Toggle Logic
                const speedToggleBtn = document.getElementById('speed-toggle-btn');
                let isFastMode = false;
                speedToggleBtn.addEventListener('click', () => {
                    isFastMode = !isFastMode;
                    if (isFastMode) {
                        intervalDuration = 2500; // 2x speed
                        speedToggleBtn.textContent = '1ë°°ì†ìœ¼ë¡œ';
                    } else {
                        intervalDuration = 5000; // 1x speed
                        speedToggleBtn.textContent = '2ë°°ì†ìœ¼ë¡œ';
                    }
                });

				const hasItem = (name) => data.packedItems.some(item => item.name === name);

				let hasPadding = hasItem('íŒ¨ë”©');
				let hasCoat = hasItem('ì½”íŠ¸');
				let hasLongSleeve = hasItem('ê¸´íŒ”ê¸´ë°”ì§€');
				let hasCardigan = hasItem('ê°€ë””ê±´');
				let hasUmbrella = hasItem('ìš°ì‚°');
                let hasSunscreen = hasItem('ì¬í¬ë¦¼');
				let hasSelfiestick = hasItem('ì…€ì¹´ë´‰');
                let hasCamera = hasItem('ì¹´ë©”ë¼');
                
                let hasSkin = hasItem('ìŠ¤í‚¨');
                let hasLotion = hasItem('ë¡œì…˜');
                let hasToothbrush = hasItem('ì–‘ì¹˜ì…‹');
                let hasPajamas = hasItem('ì ì˜·');
                let hasDryer = hasItem('ë“œë¼ì´ì–´');
                let hasCharger = hasItem('ì¶©ì „ê¸°');
                let hasAdapter = hasItem('ì–´ëŒ‘í„°');
                let hasSouvenir = hasItem('ê¸°ë…í’ˆ');
                let hasSleepKit = hasItem('ìˆ˜ë©´ì„¸íŠ¸');
                
                let hasSwimsuit = hasItem('ìˆ˜ì˜ë³µ');
                let hasBeachtowel = hasItem('ë¹„ì¹˜íƒ€ì›”');
                
                let hasBook = hasItem('ì±…');
                let hasSunglasses = hasItem('ì¬ê¸€ë¼ìŠ¤');
                
                let hasContractedCold = false; // New variable to track if cold has been contracted
                let souvenirExchangeEvent = false;

                function animateStress(element, startValue, endValue, duration, isIncrease) {
                    const startTime = performance.now();
                    const originalColor = element.style.color; // Store original color

                    if (isIncrease) {
                        element.style.color = 'red';
                    } else if (endValue < startValue) {
                        element.style.color = 'green';
                    }

                    function updateStress(currentTime) {
                        const elapsedTime = currentTime - startTime;
                        const progress = Math.min(elapsedTime / duration, 1);

                        const animatedValue = Math.floor(startValue + (endValue - startValue) * progress);
                        element.textContent = animatedValue;

                        if (progress < 1) {
                            requestAnimationFrame(updateStress);
                        } else {
                            // Animation complete, reset color after a short delay or immediately
                            element.style.color = originalColor; // Reset to original color
                        }
                    }
                    requestAnimationFrame(updateStress);
                }

                function simulateTravelDay() {
                    const rainOverlayEl = document.getElementById('rain-overlay'); // Get reference
                    rainOverlayEl.style.display = 'none';
                    
                    document.getElementById('click-sound').play();
                    let times = [];
                    if (currentDay === 1) {
                        times = timeSlots.firstDay;
                    } else if (currentDay === data.travelInfo.numberOfDays) {
                        times = timeSlots.lastDay;
                    } else {
                        times = timeSlots.intermediateDay;
                    }

                    if (currentTimeIndex < times.length) {
                        let stressChange = 0;
                        let message = '';
                        let influencingItems = []; // NEW: To track influencing items
                        const currentTimePeriod = times[currentTimeIndex];
						
						currentTimeDisplayEl.innerHTML = `ì—¬í–‰ ${currentDay}ì¼ì°¨ ${currentTimePeriod}`;

                        // Change background image based on country and time
                        const backgroundImageEl = document.getElementById('background-image');
                        const country = data.travelInfo.country.toLowerCase().replace(/\s/g, '');
                        const time = currentTimePeriod;

						let imageUrl;
                        if (time.includes('ìƒˆë²½')) {
                            imageUrl = `img/backgrounds/dawn.jpg`;
                        } else if (time.includes('ì•„ì¹¨')) {
                            imageUrl = `img/backgrounds/morning.jpg`;
                        } else if (time.includes('ê³µí•­')) {
							imageUrl = `img/backgrounds/airport.jpg`;
						} else if (time.includes('ë§ˆíŠ¸')) {
							imageUrl = `img/backgrounds/mart.jpg`;
						} else if (time.includes('ì˜¤ì „')) {
                            imageUrl = `img/backgrounds/${country}-day.jpg`;
                        } else if (time.includes('ì˜¤í›„')) {
                            imageUrl = `img/backgrounds/${country}-afternoon.jpg`;
                        } else if (time.includes('ì €ë…')) {
                            imageUrl = `img/backgrounds/night.jpg`;
                        } else {
							// default
                            imageUrl = `img/backgrounds/${country}-day.jpg`;
                        }
                        
                        backgroundImageEl.style.backgroundImage = `url('${imageUrl}')`;
						
                        const todayWeather = data.travelInfo.weather[currentDay - 1];
                        const maxTemp = todayWeather.maxTemp;
                        
                        if ((currentDay === 1 && currentTimePeriod === 'ê³µí•­') 
						    || ((currentDay >= 2 && currentDay < data.travelInfo.numberOfDays && currentTimePeriod === 'ì•„ì¹¨') 
							|| (currentDay === data.travelInfo.numberOfDays && currentTimePeriod === 'ì•„ì¹¨'))) {
                            let baseMessage = '';
                            if (maxTemp >= 0 && maxTemp <= 10) {
                                if (maxTemp <= 5) {
                                    if (hasPadding && hasLongSleeve) {
                                        stressChange = 0;
                                        baseMessage = "ë‚ ì”¨ê°€ ì¶”ìš°ë‹ˆ íŒ¨ë”©ê³¼ ê¸´íŒ”, ê¸´ë°”ì§€ë¥¼ ì…ì–´ì•¼ê² êµ°.";
                                        influencingItems.push({ name: 'íŒ¨ë”©', effect: 'positive' });
                                        influencingItems.push({ name: 'ê¸´íŒ”ê¸´ë°”ì§€', effect: 'positive' });
                                    } else if (!hasPadding && hasCoat && hasLongSleeve) {
                                        baseMessage = "íŒ¨ë”©ì€ ì•ˆì±™ê²¨ì™”ì§€ë§Œ ì½”íŠ¸ê°€ ìˆìœ¼ë‹ˆ ì´ê±¸ë¡œ ë²„í…¨ë³´ì.";
                                        influencingItems.push({ name: 'íŒ¨ë”©', effect: 'negative' });
                                        influencingItems.push({ name: 'ì½”íŠ¸', effect: 'positive' });
                                    } else {
                                        stressChange = 26;
                                        baseMessage = "ì´ëŒ€ë¡œ ìˆë‹¤ê°€ëŠ” ì–¼ì–´ ì£½ê² êµ°. ì–¼ì–´ì£½ì§€ ì•Šìœ¼ë ¤ë©´ íŒ¨ë”©ì„ ì‚¬ì•¼ê² ë„¤.";
							hasPadding = true;
							hasLongSleeve = true;
                                        influencingItems.push({ name: 'íŒ¨ë”©', effect: 'negative' });
                                        influencingItems.push({ name: 'ê¸´íŒ”ê¸´ë°”ì§€', effect: 'negative' });
                                    }
                                } else { // 5 < maxTemp <= 10
                                    if (hasPadding && hasLongSleeve) {
                                        stressChange = 0;
                                        baseMessage = "ë‚ ì”¨ê°€ ì¶”ìš°ë‹ˆ íŒ¨ë”©ê³¼ ê¸´íŒ”, ê¸´ë°”ì§€ë¥¼ ì…ì–´ì•¼ê² êµ°.";
                                        influencingItems.push({ name: 'íŒ¨ë”©', effect: 'positive' });
                                        influencingItems.push({ name: 'ê¸´íŒ”ê¸´ë°”ì§€', effect: 'positive' });
                                    } else if (!hasPadding && hasCoat && hasLongSleeve) {
                                        stressChange = 0;
                                        baseMessage = "ì½”íŠ¸ì™€ ê¸´íŒ”, ê¸´ë°”ì§€ë¡œë„ ì´ì •ë„ ë‚ ì”¨ëŠ” ê±°ëœ¬í•˜ì§€.";
                                        influencingItems.push({ name: 'ì½”íŠ¸', effect: 'positive' });
                                        influencingItems.push({ name: 'ê¸´íŒ”ê¸´ë°”ì§€', effect: 'positive' });
                                    } else if (!hasPadding && !hasCoat && hasCardigan && hasLongSleeve) {
                                        stressChange = 2;
                                        baseMessage = "ê°€ë””ê±´ê³¼ ê¸´íŒ”ê¸´ë°”ì§€ê°€ ìˆìœ¼ë‹ˆ ì´ê±¸ë¡œ ë²„í…¨ë³´ì.";
                                        influencingItems.push({ name: 'ê°€ë””ê±´', effect: 'positive' });
                                    } else {
                                        stressChange = 26;
                                        baseMessage = "ì´ëŒ€ë¡œ ìˆë‹¤ê°€ëŠ” ì–¼ì–´ ì£½ê² êµ°. ì–¼ì–´ì£½ì§€ ì•Šìœ¼ë ¤ë©´ íŒ¨ë”©ì„ ì‚¬ì•¼ê² ë„¤.";
							hasPadding = true;
							hasLongSleeve = true;
                                        influencingItems.push({ name: 'íŒ¨ë”©', effect: 'negative' });
                                        influencingItems.push({ name: 'ê¸´íŒ”ê¸´ë°”ì§€', effect: 'negative' });
                                    }
                                }
                                
                                message = baseMessage;
                                if (currentDay > 1) { // Only check for new clothes from day 2
                                    if (countItem('ê¸´íŒ”ê¸´ë°”ì§€') >= currentDay) {
                                        stressChange += -2;
                                        message += " ìƒˆ ì˜·ì„ ì…ì–´ ì‚°ëœ»í•˜ë„¤.";
                                        influencingItems.push({ name: 'ìƒˆ ì˜·', effect: 'positive' });
                                    } else {
                                        stressChange += 2;
                                        message += " ì—¬í–‰ ì¤‘ ì…ì€ ì˜·ì„ ë‹¤ì‹œ ì…ìœ¼ë‹ˆ ì•„ì‰½ë„¤.";
                                        influencingItems.push({ name: 'ìƒˆ ì˜·', effect: 'negative' });
                                    }
                                }
                            } else { // maxTemp > 10
                                stressChange = 0;
                                baseMessage = "ì„œìš¸ ë‚ ì”¨ì™€ ìœ ì‚¬í•˜ë‹ˆê¹ ì›ë˜ ì…ë˜ ì˜·ìœ¼ë¡œ ì¶©ë¶„í•˜ì§€.";
                                message = baseMessage;
                                if (currentDay > 1) { // Only check for new clothes from day 2
                                    if (countItem('ë°˜íŒ”ë°˜ë°”ì§€') >= currentDay - 1) {
                                        stressChange += -2;
                                        message += " ìƒˆ ì˜·ì„ ì…ì–´ ì‚°ëœ»í•˜ë„¤.";
                                        influencingItems.push({ name: 'ìƒˆ ì˜·', effect: 'positive' });
                                    } else {
                                        stressChange += 2;
                                        message += " ì—¬í–‰ ì¤‘ ì…ì€ ì˜·ì„ ë‹¤ì‹œ ì…ìœ¼ë‹ˆ ì•„ì‰½ë„¤.";
                                        influencingItems.push({ name: 'ìƒˆ ì˜·', effect: 'negative' });
                                    }
                                }
                            }
                        } else if (currentTimePeriod === 'ì˜¤ì „ ê´€ê´‘' || currentTimePeriod === 'ì˜¤í›„ ê´€ê´‘') {
                            const isRaining = Math.random() * 100 < todayWeather.rainChance;

                            if (isRaining) {
                                if (hasUmbrella) {
                                    stressChange = -2;
                                    message = "ë¹„ê°€ ì˜¤ëŠ”ë° ìš°ì‚°ì´ ìˆì–´ì„œ ê·¸ë‚˜ë§ˆ ê´œì°®ì€ ê´€ê´‘ì„ ì¦ê²¼ì–´.";
                                    influencingItems.push({ name: 'ìš°ì‚°', effect: 'positive' });
                                } else {
                                    stressChange = 6;
                                    message = "ë¹„ê°€ ì˜¤ëŠ”ë° ìš°ì‚°ì´ ì—†ì–´ì„œ ê´€ê´‘ì„ ë§ì³¤êµ°. ìš°ì‚°ì„ ì‚¬ì•¼ê² ì–´.";
							hasUmbrella = true;
                                    influencingItems.push({ name: 'ìš°ì‚°', effect: 'negative' });
                                }
                                
                                rainOverlayEl.style.display = 'block';
                            } else {
                                if (maxTemp > 25 && Math.random() < 0.3) {
                                    // ìˆ˜ì˜ë³µ
                                    if (hasSwimsuit) {
                                        stressChange = -6;
                                        message = "ê´€ê´‘ì„ í•˜ë‹¤ë³´ë‹ˆ ìˆ˜ì˜ì´ í•˜ê³  ì‹¶ì–´ì¡ŒëŠ”ë°, ë§ˆì¹¨ ìˆ˜ì˜ë³µì„ ì±™ê²¨ì™€ì„œ ë‹¤í–‰ì´ì•¼.";
                                        influencingItems.push({ name: 'ìˆ˜ì˜ë³µ', effect: 'positive' });
                                        if (hasBeachtowel) {
                                            stressChange -= 2;
                                            influencingItems.push({ name: 'ë¹„ì¹˜íƒ€ì›”', effect: 'positive' });
                                        }
                                    } else {
                                        stressChange = -3;
                                        message = "ê´€ê´‘ì„ í•˜ë‹¤ë³´ë‹ˆ ìˆ˜ì˜ì´ í•˜ê³  ì‹¶ì–´ì¡ŒëŠ”ë°, ìˆ˜ì˜ë³µì´ ì—†ì–´ì„œ ì•„ì‰½ë„¤.";
                                        influencingItems.push({ name: 'ìˆ˜ì˜ë³µ', effect: 'negative' });
                                    }
                                } else {
                                    if (hasSunscreen) {
                                        stressChange = -4;
                                        message = "ì¬í¬ë¦¼ì´ ìˆì–´ ìì™¸ì„  ê±±ì • ì—†ì´ ì¦ê±°ìš´ ê´€ê´‘ì„ í•  ìˆ˜ ìˆì—ˆì–´.";
                                        influencingItems.push({ name: 'ì¬í¬ë¦¼', effect: 'positive' });
                                    } else {
                                        stressChange = 5;
                                        message = "ì¬í¬ë¦¼ì„ ì±™ê¸°ì§€ ì•Šì•„ì„œ íƒˆê¹Œë´ ì‹ ê²½ ì“°ëŠë¼ ì œëŒ€ë¡œ ê´€ê´‘ì„ ëª»í–ˆêµ°. ì¬í¬ë¦¼ì„ ì‚¬ì•¼ê² ì–´.";
                                        hasSunscreen = true;
                                        influencingItems.push({ name: 'ì¬í¬ë¦¼', effect: 'negative' });
                                    }
                                }
                                
                                if (hasSunglasses) {
                                    stressChange += -1;
                                    influencingItems.push({ name: 'ì¬ê¸€ë¼ìŠ¤', effect: 'positive' });
                                } else {
                                    stressChange += 1;
                                    influencingItems.push({ name: 'ì¬ê¸€ë¼ìŠ¤', effect: 'negative' });
                                }
                                
                                rainOverlayEl.style.display = 'none';
                            }
							
							if (hasSelfiestick) {
                                stressChange -= 1;
                                influencingItems.push({ name: 'ì…€ì¹´ë´‰', effect: 'positive' });
							}
                            
                            if (hasCamera) {
                                stressChange -= 1;
                                influencingItems.push({ name: 'ì¹´ë©”ë¼', effect: 'positive' });
                            }
                        } else if (currentTimePeriod === 'ë§ˆíŠ¸') {
                            let missedRequiredItem = 0;
                            message = "ìƒê°í•´ë³´ë‹ˆ ì—¬í–‰ í•„ìˆ˜í’ˆì¸"
                            if (country !== "ì œì£¼ë„") {
                               if (!hasAdapter) {
                                  missedRequiredItem++;
                                  message += " ì–´ëŒ‘í„°";
                                  hasAdapter = true;
                                  influencingItems.push({ name: 'ì–´ëŒ‘í„°', effect: 'negative' });
                               }
                            }
                            
                            if (!hasCharger) {
                                if (missedRequiredItem > 0) {
                                    message += ", ì¶©ì „ê¸°";
                                } else {
                                    message += " ì¶©ì „ê¸°";
                                }
                                missedRequiredItem++;
                                hasCharger = true;
                                influencingItems.push({ name: 'ì¶©ì „ê¸°', effect: 'negative' });
                            }
                            
                            if (!hasToothbrush) {
                                if (missedRequiredItem > 0) {
                                    message += ", ì–‘ì¹˜ì…‹íŠ¸";
                                } else {
                                    message += " ì–‘ì¹˜ì…‹íŠ¸";
                                }
                                missedRequiredItem++;
                                hasToothbrush = true;
                                influencingItems.push({ name: 'ì–‘ì¹˜ì…‹', effect: 'negative' });
                            }
                            
                            if (missedRequiredItem === 0) {
                                message = "ìƒê°í•´ë³´ë‹ˆ í•„ìˆ˜ ì§ë“¤ì€ ë‹¤ ì±™ê²¨ì„œ ë­”ê°€ë¥¼ ì‚¬ê°ˆ í•„ìš”ëŠ” ì—†ì„ ê²ƒ ê°™ì•„.";
                            } else {
                                message += "ë¥¼ ì±™ê¸°ì§€ ëª»í–ˆêµ°. ì‚¬ì•¼ê² ì–´."
                                stressChange = 0;
                                for (let i = 0; i < missedRequiredItem; i++) {
                                    stressChange += 3;
                                }
                            }
                            
                        } else if (currentTimePeriod === 'ì €ë…') {
                            stressChange = -3; // Base relief
                            message = '';

                            if (hasBook) {
                                stressChange += -1;
                                influencingItems.push({ name: 'ì±…', effect: 'positive' });
                            }

                            // New logic for sleep kit
                            if (hasSleepKit) {
                                stressChange += -2;
                                influencingItems.push({ name: 'ìˆ˜ë©´ì„¸íŠ¸', effect: 'positive' });
                            } else {
                                // Small penalty for not having it in a budget hotel
                                stressChange += 1;
                                influencingItems.push({ name: 'ìˆ˜ë©´ì„¸íŠ¸', effect: 'negative' });
                            }
                            
                            if (hasPajamas && hasLotion && hasSkin && hasDryer) {
                                message += "ê²Œë‹¤ê°€ ì ì˜·, ë¡œì…˜, ìŠ¤í‚¨, ë“œë¼ì´ì–´ë¥¼ ê°€ì ¸ì™€ì„œ ë‹¤í–‰ì´ì•¼. ê°€ì„±ë¹„ í˜¸í…”ì´ë¼ ë¹„ì¹˜í•´ë‘”ê²Œ ë³„ë¡œë„¤.";
                                influencingItems.push({ name: 'ì ì˜·', effect: 'positive' });
                                influencingItems.push({ name: 'ë¡œì…˜', effect: 'positive' });
                                influencingItems.push({ name: 'ìŠ¤í‚¨', effect: 'positive' });
                                influencingItems.push({ name: 'ë“œë¼ì´ì–´', effect: 'positive' });
                            } else {
                                let missedOptionalItem = 0;
                                let missingMessage = "ê²Œë‹¤ê°€ ";
                                if (!hasPajamas) {
                                    missingMessage += "ì ì˜·"
                                    missedOptionalItem++;
                                    influencingItems.push({ name: 'ì ì˜·', effect: 'negative' });
                                }
                                
                                if (!hasLotion) {
                                    if (missedOptionalItem > 0) { missingMessage += ", " }
                                    missingMessage += "ë¡œì…˜"
                                    missedOptionalItem++;
                                    influencingItems.push({ name: 'ë¡œì…˜', effect: 'negative' });
                                }
                                
                                if (!hasSkin) {
                                    if (missedOptionalItem > 0) { missingMessage += ", " }
                                    missingMessage += "ìŠ¤í‚¨"
                                    missedOptionalItem++;
                                    influencingItems.push({ name: 'ìŠ¤í‚¨', effect: 'negative' });
                                }
                                
                                if (!hasDryer) {
                                    if (missedOptionalItem > 0) { missingMessage += ", " }
                                    missingMessage += "ë“œë¼ì´ì–´ë¥¼ "
                                    missedOptionalItem++;
                                    influencingItems.push({ name: 'ë“œë¼ì´ì–´', effect: 'negative' });
                                } else {
                                    missingMessage += "ì„ "
                                }
                                
                                if(missedOptionalItem > 0) {
                                    missingMessage += "ê°€ì ¸ì˜¬ ê±¸.. ê°€ì„±ë¹„ í˜¸í…”ì´ë¼ ë¹„ì¹˜í•´ë‘”ê²Œ ë³„ë¡œë„¤.";
                                    message += missingMessage;
                                } else {
                                     message += "ê°€ì ¸ì˜¨ ì„¸ë©´ë„êµ¬ë¡œ í¸ì•ˆí•œ ì €ë…ì„ ë³´ëƒˆë‹¤."
                                }

                                for (let i = 0; i < missedOptionalItem; i++) {
                                    stressChange += 1;
                                }
                            }
                            
                        } else if (currentTimePeriod === 'ì ì‹¬') {
                            if (!hasContractedCold && Math.random() < 0.03) { // 3% chance of getting a cold, only if not already contracted
                                hasContractedCold = true; // Mark cold as contracted
                                if (hasItem('ìƒë¹„ì•½')) {
                                    stressChange = 2;
                                    message = "ê°ê¸°ì— ê±¸ë ¸ì§€ë§Œ ìƒë¹„ì•½ì„ ì±™ê²¨ì™€ì„œ ë‹¤í–‰ì´ì•¼.";
                                    influencingItems.push({ name: 'ìƒë¹„ì•½', effect: 'positive' });
                                } else {
                                    stressChange = 12;
                                    message = "ê°ê¸°ì— ê±¸ë ¤ì„œ ì•½ì„ ì‚¬ë¨¹ì—ˆì§€ë§Œ, ë‚˜ì—ê²Œ ë§ëŠ” ì•½ì´ ì•„ë‹ˆë¼ íš¨ê³¼ê°€ ê·¸ë ‡ê²Œ ì¢‹ì§€ ì•Šì•˜ì–´.";
                                    influencingItems.push({ name: 'ìƒë¹„ì•½', effect: 'negative' });
                                }
                            } else if (hasSouvenir && !souvenirExchangeEvent && currentDay > 2 && Math.random() < 0.20) {
                                // No cold, ê¸°ë…í’ˆ, a good lunch
                                stressChange = -7;
                                message = 'ì ì‹¬ ì‹ì‚¬ë¥¼ í•˜ëŠ” ì¤‘ ì˜†ì— ì•‰ì€ ì™¸êµ­ì¸ê³¼ ê¸°ë…í’ˆì„ êµí™˜í–ˆì–´. ì˜ ì±™ê²¨ì™”êµ°.';
                                souvenirExchangeEvent = true;
                                influencingItems.push({ name: 'ê¸°ë…í’ˆ', effect: 'positive' });
                            } else {
                                // No cold, No ê¸°ë…í’ˆ, but a good lunch
                                stressChange = -4;
                                message = 'ì ì‹¬ ì‹ë‹¹ì„ ì‹¬ì‚¬ìˆ™ê³ í•´ì„œ ê³ ë¥¸ ë³´ëŒì´ ìˆêµ°. ì •ë§ ë§›ìˆì–´.';
                            }
                        } else if (currentTimePeriod === 'ìƒˆë²½') {
                            const underwearCount = countItem('ì†ì˜·');
                            if (underwearCount < currentDay - 1) {
                                stressChange = 2;
                                message = "ì†ì˜· ê°œìˆ˜ê°€ ë¶€ì¡±í•´ì„œ ë¹¨ì•„ì…ì–´ì•¼ê² êµ°.";
                                influencingItems.push({ name: 'ì†ì˜·', effect: 'negative' });
                            } else {
                                stressChange = -2;
                                message = "ì†ì˜·ì„ ì¶©ë¶„íˆ ì±™ê²¨ì„œ ë‹¤í–‰ì´ì•¼";
                                influencingItems.push({ name: 'ì†ì˜·', effect: 'positive' });
                            }
                        } else {
                            // Default behavior for other times
                            if (!hasMissingEssentials) {
                                stressChange = -3;
                                message = `í•„ìˆ˜í’ˆì„ ëª¨ë‘ ì±™ê²¨ì„œ í¸ì•ˆí•œ ì‹œê°„ì„ ë³´ë‚´ê³  ìˆìŠµë‹ˆë‹¤.`;
                            } else {
                                stressChange = +3;
                                message = `í•„ìˆ˜í’ˆì´ ì—†ì–´ ë¶ˆí¸í•¨ì„ ê²ªê³  ìˆìŠµë‹ˆë‹¤...`;
                            }
                        }

                        // NEW: Display influencing items
                        const stressItemDisplayEl = document.getElementById('stress-item-display');
                        if (influencingItems.length > 0) {
                            let itemsHtml = '';
                            influencingItems.forEach(item => {
                                const symbol = item.effect === 'positive' ? 'ğŸ˜Š' : 'ğŸ˜¥';
                                itemsHtml += `<div>${item.name} ${symbol}</div>`;
                            });
                            stressItemDisplayEl.innerHTML = itemsHtml;
                            stressItemDisplayEl.style.display = 'block';
                        } else {
                            stressItemDisplayEl.innerHTML = '';
                            stressItemDisplayEl.style.display = 'none';
                        }

                        const oldStress = currentStress;
                        currentStress += stressChange;
                        currentStress = Math.max(0, Math.min(100, currentStress));
                        
                        stressBarEl.style.width = currentStress + '%';

                        
                        if (currentStress >= 100) {
                            // Ensure stress is exactly 100 for animation
                            currentStress = 100;
                            setTimeout(displayGameOver, 5000); // Show game over after 5 seconds
                        } else {
                            currentTimeIndex++;
                            setTimeout(simulateTravelDay, intervalDuration);
                        }

                        // Animate stress text
                        animateStress(stressTextEl, oldStress, currentStress, 2000, stressChange > 0);

                        stressLogDisplayEl.innerHTML = message;

                        const actualStressChange = currentStress - oldStress;
                        if (actualStressChange > 0) {
                            stressLogDisplayEl.innerHTML += ` (ìŠ¤íŠ¸ë ˆìŠ¤ +${actualStressChange})`;
                        } else if (actualStressChange < 0) {
                            stressLogDisplayEl.innerHTML += ` (ìŠ¤íŠ¸ë ˆìŠ¤ ${actualStressChange})`;
                            bonusEvents++;
                        } else {
                            stressLogDisplayEl.innerHTML += " (ìŠ¤íŠ¸ë ˆìŠ¤ ë³€ë™ ì—†ìŒ)";
                        }
                    } else {
                        // End of current day, move to next day or finish
                        currentDay++;
                        currentTimeIndex = 0; // Reset time index for next day
                        if (currentDay <= data.travelInfo.numberOfDays) {
                            simulateTravelDay(intervalDuration); // Start next day
                        } else {
                            // All days complete, display final outcome
                            displayFinalOutcome();
                        }
                    }
                }

                function displayFinalOutcome() {
                    oceanWavesSound.pause();
                    document.getElementById('stress-item-display').style.display = 'none';
                    const outcomeDisplayEl = document.getElementById('outcome-display');
                    const backgroundImageEl = document.getElementById('background-image');
                    const stressLogDisplayEl = document.getElementById('stress-log-display');
                    const currentTimeDisplayEl = document.getElementById('current-time-display');
                    
					
					const imageUrl = `img/backgrounds/airport.jpg`;
					backgroundImageEl.style.backgroundImage = `url('${imageUrl}')`;

                    let outcomeMessageText = '';
                    let outcomeBonus = 0;

                    if (currentStress <= 15) {
                        outcomeMessageText = 'ëŒ€ì„±ê³µ! ì™„ë²½í•œ ì—¬í–‰ì´ì—ˆìŠµë‹ˆë‹¤!';
                        outcomeBonus = 200;
                        if(successSound) successSound.play();
                    } else if (currentStress <= 30) {
                        outcomeMessageText = 'ì„±ê³µ! ì¦ê±°ìš´ ì—¬í–‰ì´ì—ˆìŠµë‹ˆë‹¤.';
                        outcomeBonus = 100;
                        if(successSound) successSound.play();
                    } else if (currentStress <= 60) {
                        outcomeMessageText = 'ì‹¤íŒ¨! ëª©í‘œí•œë§Œí¼ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í•´ì†Œí•˜ì§€ ëª»í•œ ì•„ì‰¬ìš´ ì—¬í–‰ì´ì—ˆìŠµë‹ˆë‹¤...';
                        outcomeBonus = -100;
                        if(failSound) failSound.play();
                    } else {
                        outcomeMessageText = 'ëŒ€ì‹¤íŒ¨! ì˜¤íˆë ¤ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ìŒ“ì¸ ë¶ˆì¾Œí•œ ì—¬í–‰ì´ì—ˆìŠµë‹ˆë‹¤...';
                        outcomeBonus = -200;
                        if(failSound) failSound.play();
                    }

                    stressLogDisplayEl.innerHTML = outcomeMessageText;
                    currentTimeDisplayEl.innerHTML = "ì—¬í–‰ ê²°ì‚°";

                    // --- NEW SCORING LOGIC ---
                    const suitcaseInfo = data.suitcaseInfo;
                    const packedItems = data.packedItems;

                    // 1. Stress Score (Weight: x10)
                    const stressScore = (100 - currentStress) * 10;

                    // 2. Weight Bonus
                    const weightBonus = (suitcaseInfo.weightLimit - suitcaseInfo.currentWeight) * 10;

                    // 3. Space Bonus
                    const totalCells = suitcaseInfo.rows * suitcaseInfo.cols;
                    const usedCells = packedItems.reduce((acc, item) => acc + (item.width * item.height), 0);
                    const emptyCells = totalCells - usedCells;
                    const spaceBonus = emptyCells * 5;

                    // 4. Event Bonus (Weight: x5)
                    const eventBonus = bonusEvents * 5;

                    // 5. Total Score
                    const totalScore = stressScore + weightBonus + spaceBonus + eventBonus + outcomeBonus;
                    finalCalculatedScore = Math.round(totalScore); // Assign to the new variable

                    setTimeout(() => {
                        // Populate and show the score modal
                        scoreModalContent.innerHTML = 
                            `<h2 style="text-align: center;">ìµœì¢… ì ìˆ˜: ${finalCalculatedScore}ì </h2>
                            <p><strong>ê¸°ë³¸ ì ìˆ˜:</strong> ${stressScore}ì  ((100 - ìŠ¤íŠ¸ë ˆìŠ¤ ${currentStress}) x 10)</p>
                            <p><strong>ë¬´ê²Œ ë³´ë„ˆìŠ¤:</strong> ${Math.round(weightBonus)}ì  (${(suitcaseInfo.weightLimit - suitcaseInfo.currentWeight).toFixed(1)}kg ë‚¨ìŒ x 10)</p>
                            <p><strong>ê³µê°„ ë³´ë„ˆìŠ¤:</strong> ${spaceBonus}ì  (${emptyCells}ì¹¸ ë‚¨ìŒ x 5)</p>
                            <p><strong>ì´ë²¤íŠ¸ ë³´ë„ˆìŠ¤:</strong> ${eventBonus}ì  (ê¸ì • ì´ë²¤íŠ¸ ${bonusEvents}íšŒ x 5)</p>
                            <p><strong>ê²°ê³¼ ë³´ë„ˆìŠ¤:</strong> ${outcomeBonus}ì </p>
                        `;
                        scoreModal.style.display = 'flex';
                    }, 2500);

                    // Scroll to the top to show the outcome
                    window.scrollTo(0, 0);
                }

                function displayGameOver() {
                    oceanWavesSound.pause();
                    if(gameoverSound) gameoverSound.play();

                    const outcomeDisplayEl = document.getElementById('outcome-display');
                    const backgroundImageEl = document.getElementById('background-image');
                    const stressLogDisplayEl = document.getElementById('stress-log-display');
                    const currentTimeDisplayEl = document.getElementById('current-time-display');

                    // Clear any pending timeouts to stop the simulation
                    // (Though 'return' in simulateTravelDay already handles this for the current call)

                    const imageUrl = `img/backgrounds/airport.jpg`; // Or a specific game over image
                    backgroundImageEl.style.backgroundImage = `url('${imageUrl}')`;

                    stressLogDisplayEl.innerHTML = 'ìŠ¤íŠ¸ë ˆìŠ¤ê°€ 100ì´ ë˜ì–´ ì—¬í–‰ì„ í¬ê¸°í–ˆìŠµë‹ˆë‹¤. Game Over!';
                    currentTimeDisplayEl.innerHTML = "ê²Œì„ ì˜¤ë²„";

                    // Optionally, disable further interaction or show a restart button
                    // For now, just display the message

                    window.scrollTo(0, 0);
                }

                // Start the simulation via popup
                const startPopup = document.getElementById('start-popup');
                const startButton = document.getElementById('start-button');

                startButton.addEventListener('click', () => {
                    startPopup.style.display = 'none';
                    document.getElementById('click-sound').play();
                    if (oceanWavesSound) {
                        oceanWavesSound.volume = 0.4;
                        oceanWavesSound.play();
                    }
                    simulateTravelDay();
                });

            } else {
                document.querySelector('.container').innerHTML = '<h1>ì €ì¥ëœ ì—¬í–‰ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</h1><button class="back-button" onclick="window.location.href=\'pack.html\'">ì§ì‹¸ëŸ¬ ê°€ê¸°</button>';
            }
        });
    </script>
</body>
</html>